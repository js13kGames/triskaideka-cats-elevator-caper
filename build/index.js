let aa=!0,e=!1,ba=[],h=!1,n=!1,ca=!1,fa=!1,ha,ia;function q(a,b){b?console.assert(a,b):console.assert(a)}function ja(a,b=u(),d="#fff",c=0,f=0,k=!1){q("string"==typeof d,"pass in css color strings");ba.push({g:a,size:u(b),color:d,time:new ka(c),angle:f,fill:k})}function la(a,b=0,d="#fff"){q("string"==typeof d,"pass in css color strings");ba.push({g:a,size:b,color:d,time:new ka(0),angle:0,fill:!0})}
function ma(a,b,d,c=.1){b=u((b.x-a.x)/2,(b.y-a.y)/2);c=u(c,2*b.length());ja(a.add(b),c,d,void 0,b.angle(),!0)}function na(a,b,d,c,f){const k=u(Math.min(a.x-b.x/2,d.x-c.x/2),Math.min(a.y-b.y/2,d.y-c.y/2));a=u(Math.max(a.x+b.x/2,d.x+c.x/2),Math.max(a.y+b.y/2,d.y+c.y/2));ja(k.Ca(a,.5),a.s(k),f)}function oa(a,b){q(!0,"pass in css color strings");ba.push({text:a,g:b,size:.2,color:"#fff",time:new ka(0),angle:0,font:"monospace"})}
function pa(){var a=v.toDataURL("image/png");ia.download="LittleJS";ia.href=a;ia.click()}
function ra(){sa(w);ha&&(sa(w,!0),w.drawImage(v,0,0),v.width|=0,x.fillRect(0,0,z.width,z.height),x.drawImage(z,0,0),pa(),ha=0);if(fa&&ta&&navigator.getGamepads){var a=navigator.getGamepads();for(var b=a.length;b--;){var d=a[b];if(d){var c=A,f=ua[b];for(var k=f.length;k--;){const t=c.add(u(2*k,3*b)),l=t.add(f[k].scale(1));la(t,1,"#fff7");ma(t,l,"#f00");ja(l,void 0,"#f00")}for(f=d.buttons.length;f--;)k=c.add(u(.4*f,3*b-1-.2)),la(k,.2,d.buttons[f].pressed?"#f00":"#fff7"),oa(""+f,k)}}}if(e){a=w;w=x;b=
B.scale(1/C);ja(A,b.s(u(.1)),"#f008");b=Infinity;for(var g of D)if(!g.canvas&&!g.I&&g.size.x&&g.size.y){d=va(g.g);if(d<b){b=d;var m=g}d=u(Math.max(g.size.x,.2),Math.max(g.size.y,.2));c=g.parent?new E(1,1,1,.5):new E(0,0,0,.8);F(g.g,d,new E(g.ya?1:0,g.da?1:0,g.qa?1:0,g.parent?.2:.5),g.angle,!1);F(g.g,d.scale(.8),c,g.angle,!1);g.parent&&wa(g.g,g.parent.g,new E(0,0,1,.5))}m&&((g=xa(m.g))&&F(g.floor().add(u(.5)),u(1),new E(0,1,1,.3)),F(G.floor().add(u(.5)),u(1),new E(0,0,1,.5),0,!1),wa(G,m.g,g?new E(1,
0,0,.5):new E(0,1,0,.5)),m="mouse pos = "+G+"\nmouse collision = "+ya(G)+"\n\n--- object info ---\n"+m.toString(),H(m,za,24,new E,.05,void 0,"center","monospace"));sa(w=a)}x.lineWidth=2;const p=.5*C;ba.forEach(t=>{x.save();var l=Aa(t.g);x.translate(l.x|0,l.y|0);x.rotate(t.angle);x.fillStyle=x.strokeStyle=t.color;if(void 0!=t.text)x.font=t.size*C+"px "+t.font,x.textAlign="center",x.textBaseline="middle",x.fillText(t.text,0,0);else if(0==t.size||0===t.size.x&&0===t.size.y)x.fillRect(-p/2,-1,p,3),x.fillRect(-1,
-p/2,3,p);else if(void 0!=t.size.x){l=t.size.x*C|0;const y=t.size.y*C|0;t.fill&&x.fillRect(-l/2|0,-y/2|0,l,y);x.strokeRect(-l/2|0,-y/2|0,l,y)}else x.beginPath(),x.arc(0,0,t.size*C,0,9),t.fill&&x.fill(),x.stroke();x.restore()});ba=ba.filter(t=>0>t.time);x.save();x.fillStyle="#fff";x.textAlign="left";x.textBaseline="top";x.font="28px monospace";x.shadowColor="#000";x.shadowBlur=9;m=-20;if(e){x.fillText("LittleJS",9,m+=30);x.fillText("Objects: "+D.length,9,m+=30);x.fillText("Time: "+Ba(),9,m+=30);x.fillText("---------",
9,m+=30);x.fillStyle="#f00";x.fillText("ESC: Debug Overlay",9,m+=30);x.fillStyle=h?"#f00":"#fff";x.fillText("1: Debug Physics",9,m+=30);x.fillStyle=ca?"#f00":"#fff";x.fillText("2: Debug Particles",9,m+=30);x.fillStyle=fa?"#f00":"#fff";x.fillText("3: Debug Gamepads",9,m+=30);x.fillStyle=n?"#f00":"#fff";x.fillText("4: Debug Raycasts",9,m+=30);x.fillStyle="#fff";x.fillText("5: Save Screenshot",9,m+=30);g="";for(var r in I[0])J(r,0)&&(g+=r+" ");g&&x.fillText("Keys Down: "+g,9,m+=30);r="";if(I[1])for(const t in I[1])J(t,
1)&&(r+=t+" ");r&&x.fillText("Gamepad: "+r,9,m+=30)}else x.fillText(h?"Debug Physics":"",9,m+=30),x.fillText(ca?"Debug Particles":"",9,m+=30),x.fillText(n?"Debug Raycasts":"",9,m+=30),x.fillText(fa?"Debug Gamepads":"",9,m+=30);x.restore()}const Ca=Math.PI;function K(a,b=0,d=1){return a<b?b:a>d?d:a}function Da(a,b,d){return d-b?K((a-b)/(d-b)):0}function Ea(a,b,d,c=u()){return 2*Math.abs(a.x-d.x)<b.x+c.x&&2*Math.abs(a.y-d.y)<b.y+c.y}
function Ba(){var a=Fa;return(a/60|0)+":"+(10>a%60?"0":"")+(a%60|0)}function Ga(a=1,b=0){return b+Math.random()*(a-b)}function u(a=0,b){return"number"===typeof a?new L(a,void 0==b?a:b):new L(a.x,a.y)}function M(a){return a instanceof L}function va(a){var b=G;q(M(a));return(b.x-a.x)**2+(b.y-a.y)**2}function Ha(a=0){var b=new L;b.x=.001*Math.sin(a);b.y=.001*Math.cos(a);return b}function Ia(a){const b=a.length();return 1<b?a.scale(1/b):a}
class L{constructor(a=0,b=0){this.x=a;this.y=b}T(){return new L(this.x,this.y)}add(a){q(M(a));return new L(this.x+a.x,this.y+a.y)}s(a){q(M(a));return new L(this.x-a.x,this.y-a.y)}multiply(a){q(M(a));return new L(this.x*a.x,this.y*a.y)}ha(a){q(M(a));return new L(this.x/a.x,this.y/a.y)}scale(a){q(!M(a));return new L(this.x*a,this.y*a)}length(){return(this.x**2+this.y**2)**.5}normalize(a=1){const b=this.length();return b?this.scale(a/b):new L(0,a)}angle(){return Math.atan2(this.x,this.y)}rotate(a){const b=
Math.cos(a);a=Math.sin(a);return new L(this.x*b-this.y*a,this.x*a+this.y*b)}setDirection(a,b=1){q(0==a||1==a||2==a||3==a);return u(a%2?a-1?-b:b:0,a%2?0:a?-b:b)}direction(){return Math.abs(this.x)>Math.abs(this.y)?0>this.x?3:1:0>this.y?2:0}floor(){return new L(Math.floor(this.x),Math.floor(this.y))}Ca(a,b){q(M(a));return this.add(a.s(this).scale(K(b)))}toString(a=3){return`(${(0>this.x?"":" ")+this.x.toFixed(a)},${(0>this.y?"":" ")+this.y.toFixed(a)} )`}}function Ja(a){return a instanceof E}
function Ka(){var a=new E;const b=(d,c,f)=>(f=(f%1+1)%1)<1/6?d+6*(c-d)*f:.5>f?c:f<2/3?d+(c-d)*(2/3-f)*6:d;a.r=b(.2,.2,1/3);a.j=b(.2,.2,0);a.b=b(.2,.2,-(1/3));a.a=1;return a}function La(a){return(255*K(a.r)|0)+(255*K(a.j)<<8)+(255*K(a.b)<<16)+(255*K(a.a)<<24)}
class E{constructor(a=1,b=1,d=1,c=1){this.r=a;this.j=b;this.b=d;this.a=c}T(){return new E(this.r,this.j,this.b,this.a)}add(a){q(Ja(a));return new E(this.r+a.r,this.j+a.j,this.b+a.b,this.a+a.a)}s(a){q(Ja(a));return new E(this.r-a.r,this.j-a.j,this.b-a.b,this.a-a.a)}multiply(a){q(Ja(a));return new E(this.r*a.r,this.j*a.j,this.b*a.b,this.a*a.a)}ha(a){q(Ja(a));return new E(this.r/a.r,this.j/a.j,this.b/a.b,this.a/a.a)}scale(a,b=a){return new E(this.r*a,this.j*a,this.b*a,this.a*b)}Ca(a,b){q(Ja(a));return this.add(a.s(this).scale(K(b)))}toString(a=
!0){const b=d=>(16>(d=255*d|0)?"0":"")+d.toString(16);return"#"+b(this.r)+b(this.j)+b(this.b)+(a?b(this.a):"")}}class ka{constructor(a){this.time=void 0==a?void 0:Fa+a;this.setTime=a}set(a=0){this.time=Fa+a;this.setTime=a}active(){return Fa<=this.time}get(){return void 0!=this.time?Fa-this.time:0}toString(){return void 0!=this.time?Math.abs(this.get())+" seconds "+(0>this.get()?"before":"after"):"unset"}valueOf(){return this.get()}}
let A=u(),C=32,Na=u(1920,1200),Oa=u(),Pa="arial",N=!0,Qa=!0,Ra=.1,ta=!0;function O(a){if(!a.I){a.I=1;a.parent&&a.parent.removeChild(a);for(const b of a.children)O(b,b.parent=0)}}
class Sa{constructor(a=u(),b=u(1)){q(M(a)&&M(b),"ensure pos and size are vec2s");q(!0,"old style tile setup");this.g=a.T();this.size=b;this.Ua=this.Ka=void 0;this.angle=0;this.Ha=this.color=void 0;this.sa=!1;this.ba=this.D=this.i=1;this.V=0;this.Na=.8;this.ka=1;this.Ga=0;this.h=u();this.va=0;this.children=[];this.parent=void 0;this.Sa=u();this.Ra=0;this.qa=this.da=this.ya=!1;D.push(this)}update(){var a=this.parent;if(a)this.g=this.Sa.multiply(u(a.sa?-1:1,1)).rotate(-a.angle).add(a.g),this.angle=(a.sa?
-1:1)*this.Ra+a.angle;else if(this.h.x=K(this.h.x,-1,1),this.h.y=K(this.h.y,-1,1),a=this.g.T(),this.h.y+=0*this.ka,this.g.x+=this.h.x*=this.D,this.g.y+=this.h.y*=this.D,this.angle+=this.va*=this.ba,q(0<=this.ba&&1>=this.ba),q(0<=this.D&&1>=this.D),this.i){var b=0>this.h.y;if(this.L){var d=this.L.h?this.L.h.x:0;this.h.x=d+(this.h.x-d)*this.Na;this.L=0}if(this.da)for(var c of Ta){if(!this.qa&&!c.qa||c.I||c.parent||c==this)continue;if(!Ea(this.g,this.size,c.g,c.size))continue;if(Ea(a,this.size,c.g,c.size)){d=
a.s(c.g);var f=d.length();d=.01>f?Ha(Ga(2*Ca)):d.scale(.001/f);this.h=this.h.add(d);c.i&&(c.h=c.h.s(d));e&&h&&na(this.g,this.size,c.g,c.size,"#f00");continue}f=this.size.add(c.size);var k=2*(a.y-c.g.y)>f.y+0;const m=2*Math.abs(a.y-c.g.y)<f.y;var g=2*Math.abs(a.x-c.g.x)<f.x;d=Math.max(this.V,c.V);if(k||g||!m)if(this.g.y=c.g.y+(f.y/2+.001)*Math.sign(a.y-c.g.y),c.L&&b||!c.i)b&&(this.L=c),this.h.y*=-d;else if(c.i){g=(this.i*this.h.y+c.i*c.h.y)/(this.i+c.i);const p=c.h.y*(c.i-this.i)/(this.i+c.i)+2*this.h.y*
this.i/(this.i+c.i);this.h.y=g+K(d)*(this.h.y*(this.i-c.i)/(this.i+c.i)+2*c.h.y*c.i/(this.i+c.i)-g);c.h.y=g+K(d)*(p-g)}!k&&m&&(this.g.x=c.g.x+(f.x/2+.001)*Math.sign(a.x-c.g.x),c.i?(f=(this.i*this.h.x+c.i*c.h.x)/(this.i+c.i),k=c.h.x*(c.i-this.i)/(this.i+c.i)+2*this.h.x*this.i/(this.i+c.i),this.h.x=f+K(d)*(this.h.x*(this.i-c.i)/(this.i+c.i)+2*c.h.x*c.i/(this.i+c.i)-f),c.h.x=f+K(d)*(k-f)):this.h.x*=-d);e&&h&&na(this.g,this.size,c.g,c.size,"#f0f")}if(this.ya&&Ua(this.g,this.size,this)&&!Ua(a,this.size,
this)){c=Ua(u(this.g.x,a.y),this.size,this);if(Ua(u(a.x,this.g.y),this.size,this)||!c)this.L=b,this.h.y*=-this.V,b=(a.y-this.size.y/2|0)-(a.y-this.size.y/2),0>b&&b>this.D*this.h.y+0*this.ka&&(this.h.y=this.D?(b-0*this.ka)/this.D:0),this.g.y=a.y;c&&(this.g.x=a.x,this.h.x*=-this.V)}}}C(){Va(this.g,this.Ka||this.size,this.Ua,this.color,this.angle,this.sa,this.Ha)}removeChild(a){q(a.parent==this&&this.children.includes(a));this.children.splice(this.children.indexOf(a),1);a.parent=0}toString(){let a="type = "+
this.constructor.name;if(this.g.x||this.g.y)a+="\npos = "+this.g;if(this.h.x||this.h.y)a+="\nvelocity = "+this.h;if(this.size.x||this.size.y)a+="\nsize = "+this.size;this.angle&&(a+="\nangle = "+this.angle.toFixed(3));this.color&&(a+="\ncolor = "+this.color);return a}}let z,w,v,x,B=u(),Wa=[],Xa;
class Ya{constructor(a){this.image=a;this.size=u(a.width,a.height);var b;if(b=N)b=P.createTexture(),P.bindTexture(3553,b),a&&P.texImage2D(3553,0,6408,6408,5121,a),P.texParameteri(3553,10241,9728),P.texParameteri(3553,10240,9728);this.Aa=b;this.Ma=u(Ra).ha(this.size)}}function Za(){var a=za;return new L((a.x-B.x/2+.5)/C+A.x,(a.y-B.y/2+.5)/-C+A.y)}function Aa(a){return new L((a.x-A.x)*C+B.x/2-.5,(a.y-A.y)*-C+B.y/2-.5)}
function Va(a,b=u(1),d,c=new E,f=0,k,g=new E(0,0,0,0),m=N){q(!0,"context only supported in canvas 2D mode");q("number"!==typeof d||!d,"this is an old style calls, to fix replace it with tile(tileIndex, tileSize)");const p=d&&d.Va();if(m)if(p){m=d.g.x/p.size.x;const r=d.g.y/p.size.y,t=d.size.x/p.size.x,l=d.size.y/p.size.y,y=p.Ma;$a(p.Aa);ab(a.x,a.y,k?-b.x:b.x,b.y,f,m+y.x,r+y.y,m-y.x+t,r-y.y+l,La(c),La(g))}else ab(a.x,a.y,b.x,b.y,f,0,0,0,0,0,La(c));else aa&&++Xa,bb(a,b,f,k,r=>{if(p){const t=d.g.x+Ra,
l=d.g.y+Ra,y=d.size.x-2*Ra,qa=d.size.y-2*Ra;r.globalAlpha=c.a;r.drawImage(p.image,t,l,y,qa,-.5,-.5,1,1);r.globalAlpha=1}else r.fillStyle=c,r.fillRect(-.5,-.5,1,1)})}function F(a,b,d,c,f){Va(a,b,void 0,d,c,!1,void 0,f)}function wa(a,b,d){b=u((b.x-a.x)/2,(b.y-a.y)/2);const c=u(.1,2*b.length());F(a.add(b),c,d,b.angle(),!1)}function bb(a,b,d,c,f){var k=w;a=Aa(a);b=b.scale(C);k.save();k.translate(a.x+.5,a.y+.5);k.rotate(d);k.scale(c?-b.x:b.x,b.y);f(k);k.restore()}
function H(a,b,d=1,c=new E,f=0,k=new E(0,0,0),g="center",m=Pa){var p=x;p.fillStyle=c.toString();p.lineWidth=f;p.strokeStyle=k.toString();p.textAlign=g;p.font=d+"px "+m;p.textBaseline="middle";p.lineJoin="round";b=b.T();(a+"").split("\n").forEach(r=>{f&&p.strokeText(r,b.x,b.y);p.fillText(r,b.x,b.y);b.y+=d})}function J(a,b=0){q(0<b||"number"!==typeof a||3>a,"use code string for keyboard");return I[b]&&!!(I[b][a]&1)}
function Q(a){q("number"!==typeof a||3>a,"use code string for keyboard");return I[0]&&!!(I[0][a]&2)}let G=u(),za=u(),cb=!1;function db(a,b=0){return J(a,b+1)}let I=[[]];function eb(){for(const a of I)for(const b in a)a[b]&=1}onkeydown=a=>{a.target!=document.body||a.repeat||(cb=!1,I[0][a.code]=3,I[0][fb(a.code)]=3)};onkeyup=a=>{a.target==document.body&&(I[0][a.code]=4,I[0][fb(a.code)]=4)};
function fb(a){return"KeyW"==a?"ArrowUp":"KeyS"==a?"ArrowDown":"KeyA"==a?"ArrowLeft":"KeyD"==a?"ArrowRight":a}onmousedown=a=>{cb=!1;I[0][a.button]=3;za=gb(a);a.button&&a.preventDefault()};onmouseup=a=>I[0][a.button]=I[0][a.button]&2|4;onmousemove=a=>za=gb(a);onwheel=a=>a.ctrlKey?0:Math.sign(a.deltaY);oncontextmenu=()=>!1;function gb(a){if(!z)return u();const b=z.getBoundingClientRect();return u(z.width,z.height).multiply(u(Da(a.x,b.left,b.right),Da(a.y,b.top,b.bottom)))}const ua=[];
function hb(){const a=f=>{const k=g=>.3<g?Da(g,.3,.8):-.3>g?-Da(-g,.3,.8):0;return Ia(u(k(f.x),k(-f.y)))};if(ta&&navigator&&navigator.getGamepads){var b=navigator.getGamepads();for(let f=b.length;f--;){var d=b[f];const k=I[f+1]||(I[f+1]=[]),g=ua[f]||(ua[f]=[]);if(d){for(var c=0;c<d.axes.length-1;c+=2)g[c>>1]=a(u(d.axes[c],d.axes[c+1]));for(c=d.buttons.length;c--;){const m=d.buttons[c],p=db(c,f);k[c]=m.pressed?p?1:3:p?4:0;cb||=!f&&m.pressed}d=u((db(15,f)&&1)-(db(14,f)&&1),(db(12,f)&&1)-(db(13,f)&&
1));d.x**2+d.y**2&&(g[0]=Ia(d))}}}}const ib=void 0!==window.ontouchstart;if(ib){let a;onmousedown=onmouseup=()=>0;ontouchstart=ontouchmove=ontouchend=b=>{R&&"running"!=R.state&&jb();const d=b.touches.length;d?(za=gb(u(b.touches[0].clientX,b.touches[0].clientY)),a?cb=!1:I[0][0]=3):a&&(I[0][0]=I[0][0]&2|4);a=d;document.hasFocus()&&b.preventDefault();return!0}}let R=new AudioContext,kb=!1;
function jb(){var a=[pb()],b=kb;if(kb="running"!=R.state)if(R.resume(),b)return;const d=R.createBuffer(a.length,a[0].length,44100);b=R.createBufferSource();a.forEach((c,f)=>d.getChannelData(f).set(c));b.buffer=d;b.playbackRate.value=1;b.loop=!1;a=R.createGain();a.gain.value=.5;a.connect(R.destination);b.connect(new StereoPannerNode(R,{pan:K(0,-1,1)})).connect(a);b.start()}
function pb(){var a=220,b=0,d,c,f;let k=2*Ca,g=b*=500*k/44100/44100,m=a*=Ga(1.05,.95)*k/44100,p=[],r=0,t=0,l=0,y=1,qa=0,Ob=0,S=0,Ma,da;var ea=9;var lb=f=0;var mb=4410;var T=0;var Pb=500*k/44100**3*0;var Qb=k/44100*0;var nb=k/44100*0;var ob=c=d=0;for(da=ea+f+lb+mb+T|0;l<da;p[l++]=S*ob)++Ob%0||(S=Math.sin(r),S=(c?1+0*Math.sin(k*l/c):1)*Math.sign(S)*Math.abs(S)**1*(l<ea?l/ea:l<ea+f?1-(l-ea)/f*0:l<ea+f+lb?1:l<da-T?(da-l-T)/mb:0),S=T?S/2+(T>l?0:(l<da-T?1:(da-l)/T)*p[l-T|0]/2/ob):S),Ma=(a+=b+=Pb)*Math.cos(Qb*
t++),r+=Ma+0*Ma*Math.sin(l**5),y&&++y>d&&(a+=nb,m+=nb,y=0),!c||++qa%c||(a=m,b=g,y=y||1);return p}let qb=[],rb=u();function ya(a){var b=rb;q(M(b));return 0<=a.x&&0<=a.y&&a.x<b.x&&a.y<b.y?qb[(a.y|0)*rb.x+a.x|0]:0}function Ua(a,b=u(),d){const c=Math.max(a.x-b.x/2|0,0);var f=Math.max(a.y-b.y/2|0,0);const k=Math.min(a.x+b.x/2,rb.x);for(a=Math.min(a.y+b.y/2,rb.y);f<a;++f)for(b=c;b<k;++b){const g=qb[f*rb.x+b];if(g&&(!d||0<g))return!0}}
function xa(a){var b=G;const d=b.s(a),c=d.length();var f=d.normalize();const k=u(Math.abs(1/f.x),Math.abs(1/f.y));f=a.floor();let g=k.x*(0>d.x?a.x-f.x:f.x-a.x+1),m=k.y*(0>d.y?a.y-f.y:f.y-a.y+1);for(;;){if(ya(f))return n&&ma(a,b,"#f00",.02),n&&(a=f.add(u(.5)),ja(a,void 0,"#ff0")),f.add(u(.5));if(g>c&&m>c)break;g>m?(f.y+=Math.sign(d.y),m+=k.y):(f.x+=Math.sign(d.x),g+=k.x)}n&&ma(a,b,"#00f",.02)}let sb=[],tb;function ub(){if(sb.length){var a=sb[0],b=vb-tb;tb?5<b?(tb=0,sb.shift()):a.C():tb=vb}}
let U,P,wb,xb,yb,zb,V,Ab,W,Bb,Cb;
function Db(){U=document.createElement("canvas");P=U.getContext("webgl2");Qa&&document.body.appendChild(U);var a=P.createProgram();P.attachShader(a,Eb("#version 300 es\nprecision highp float;uniform mat4 m;in vec2 g;in vec4 p,u,c,a;in float r;out vec2 v;out vec4 d,e;void main(){vec2 s=(g-.5)*p.zw;gl_Position=m*vec4(p.xy+s*cos(r)-vec2(-s.y,s)*sin(r),1,1);v=mix(u.xw,u.zy,g);d=c;e=a;}",35633));P.attachShader(a,Eb("#version 300 es\nprecision highp float;in vec2 v;in vec4 d,e;uniform sampler2D s;out vec4 c;void main(){c=texture(s,v)*d+e;}",35632));
P.linkProgram(a);if(!P.getProgramParameter(a,35714))throw P.getProgramInfoLog(a);wb=a;a=new ArrayBuffer(44E4);V=new Float32Array(a);Ab=new Uint32Array(a);yb=P.createBuffer();zb=P.createBuffer();a=new Float32Array([W=0,0,1,0,0,1,1,1]);P.bindBuffer(34962,zb);P.bufferData(34962,a,35044)}
function Fb(){P.viewport(0,0,U.width=z.width,U.height=z.height);P.clear(16384);P.useProgram(wb);P.activeTexture(33984);P.bindTexture(3553,xb=Wa[0].Aa);let a=Bb=Cb=0;var b=(c,f,k,g)=>{c=P.getAttribLocation(wb,c);const m=k&&44,p=k&&1,r=1==k;P.enableVertexAttribArray(c);P.vertexAttribPointer(c,g,f,r,m,a);P.vertexAttribDivisor(c,p);a+=g*k};P.bindBuffer(34962,zb);b("g",5126,0,2);P.bindBuffer(34962,yb);P.bufferData(34962,44E4,35048);b("p",5126,4,4);b("u",5126,4,4);b("c",5121,1,4);b("a",5121,1,4);b("r",
5126,4,1);b=u(2*C).ha(B);const d=u(-1).s(A.multiply(b));P.uniformMatrix4fv(P.getUniformLocation(wb,"m"),!1,new Float32Array([b.x,0,0,0,0,b.y,0,0,1,1,1,1,d.x,d.y,0,0]))}function $a(a){a!=xb&&(Gb(),P.bindTexture(3553,xb=a))}function Eb(a,b){b=P.createShader(b);P.shaderSource(b,a);P.compileShader(b);if(!P.getShaderParameter(b,35713))throw P.getShaderInfoLog(b);return b}
function Gb(){if(W){var a=Cb?1:771;P.blendFuncSeparate(770,a,1,a);P.enable(3042);P.bufferSubData(34962,0,V);P.drawArraysInstanced(5,0,4,W);aa&&(Xa+=W);W=0;Cb=Bb}}function sa(a,b=!1){if(W||b)Gb(),Qa&&!b||a.drawImage(U,0,0)}function ab(a,b,d,c,f,k,g,m,p,r,t=0){q("number"==typeof r&&"number"==typeof t,"invalid color");(1E4<=W||Cb!=Bb)&&Gb();let l=11*W;V[l++]=a;V[l++]=b;V[l++]=d;V[l++]=c;V[l++]=k;V[l++]=g;V[l++]=m;V[l++]=p;Ab[l++]=r;Ab[l++]=t;V[l++]=f;W++}let D=[],Ta=[],Hb=0,Fa=0,vb=0,Ib=0,X=0,Jb=0;
function Kb(){function a(b){if(!b.I){b.update();for(const d of b.children)a(d)}}Ta=D.filter(b=>b.da);for(const b of D)b.parent||a(b);D=D.filter(b=>!b.I)}function Lb(a,b){a.U=b;a.U.o()}function Mb(a){var b=Y.l;b.Z=b.m().getState().result;b.ia=!1;Lb(b,a)}
class Nb{constructor(){this.ga=this.ia=this.pa=!1;this.U=null;this.H=[];this.Z=null;this.ra=9}X(){return this.ga}m(){return this.U}oa(){Lb(this,new Rb);this.pa=!0}ea(){this.U.complete();this.pa=!1}R(){this.ia=!0;this.ga=!1;var a=new Sb(this.H);Lb(this,a)}ja(){this.ra--;this.ga=!0;Lb(this,new Tb(this.ra))}}function Ub(a){var b=a.l.X()&&a.l.m().W();return 0==a.l.ra||b}
class Vb{constructor(){this.l=new Nb;this.ua=!0}m(){return this.l.m()}X(){return this.l.X()}oa(){this.l.oa()}ea(){this.l.ea()}R(){this.l.R()}ja(){Ub(this)||this.l.ja()}}class Wb{constructor(a=""){this.active=this.S=this.M=!1;this.name=a;this.result=null}O(){this.S=this.M=!0;this.active=!1}complete(){this.M=!0;this.active=this.S=!1}W(){return this.M&&this.S}ma(){return this.M}isActive(){return this.active}}
class Xb extends Sa{constructor(a=""){super();this.state=new Wb(a)}K(){this.state.isActive()}o(){var a=this.state;a.M=!1;a.S=!1;a.result=null;a.active=!0}J(){}F(){}getState(){return this.state}complete(){this.state.complete()}ma(){return this.state.ma()}O(){this.state.O()}W(){return this.state.W()}na(){var a=this.state;return a.M&&!a.S}}
class Sb extends Xb{constructor(a){super("elevator");this.Ja=new E(.3,.3,.3);this.La=new E(.3,.8,.3);this.wa=4.5;this.xa=2.5;this.Ia=u(0,-.5);this.backgroundColor=Ka();this.G=u(2,6);this.ca=new Yb(this.G.x,a);a=new u;for(a.x=this.G.x;a.x--;)for(a.y=this.G.y;a.y--;){var b=this.ca,d=a.x+a.y*b.la,c=Zb(b,d),f=$b(b,d);c=new ac(a,d,c,f);console.log(c);b.buttons[d]=c}}o(){super.o();Oa=u(1920,1080);z.style.background=this.backgroundColor;A=this.G.scale(1).add(this.Ia);C=900/this.G.y}K(){if(this.state.isActive()){if(Q(0)){var a=
G.floor().s(u(Math.floor(this.wa),Math.floor(this.xa)));var b=this.ca;a=b.buttons[a.x+a.y*b.la]??!1}else a=!1;a&&a.getState().isEnabled()&&(this.state.result=a,this.complete())}}J(){}F(){if(this.state.isActive()){H("The Elevator Stage",u(B.x/2,70),80);var a=u();for(a.x=this.G.x;a.x--;)for(a.y=this.G.y;a.y--;){const d=a.add(u(this.wa,this.xa));var b=this.ca;if(b=b.buttons[a.x+a.y*b.la])H((b.index+1).toString(),Aa(d),.2*C,void 0,0*C),b=b.getState().isEnabled()?this.La:this.Ja,F(d,u(.9),b)}}}}
class ac{constructor(a,b,d,c){this.x=a.x;this.y=a.y;this.index=b;this.state=new bc(d,c)}getState(){return this.state}}function Zb(a,b){if(a.Qa)return 0==b;if($b(a,b))return!1;var d=0,c=null;a.H.forEach(f=>{f.index>=d&&(d=f.index,c=f)});console.log("highest completed index",d);console.log("highest completed level",c);return c&&c.getState().fa?b==d+1:b==d}function $b(a,b){a=a.H.find(d=>d.index==b);return a?.state?a.state.fa:!1}
class Yb{constructor(a,b){this.la=a;this.H=b;this.buttons=[];this.Qa=!b||0==b.length;console.log(this.H)}}class bc{constructor(a,b){this.enabled=a;this.fa=b}isEnabled(){return this.enabled}enable(){this.enabled=!0}disable(){this.enabled=!1}complete(){this.fa=!0;this.disable()}}
class Tb extends Xb{constructor(a){super("continue");this.Da=a;this.Ea="The bell hath tolled for thee.;Don't fear the reaper.;Your strength has failed you.;Oh my. That was a cat-tastrophe.;What claw-ful luck you're having.;Try to keep a paw-sitive cat-itude.;Welp, that cat's not getting outta the bag again.".split(";");this.za=null}o(){super.o();this.za=this.Ea[Math.floor(Ga(this.Ea.length-1,0))]}K(){this.state.isActive()&&(0==this.Da?this.O():Q(cc)?this.complete():Q(dc)&&this.O())}F(){this.state.isActive()&&
(H(this.za,u(B.x/2,100),80),H(`Lives Left: ${this.Da}`,u(B.x/2,200),60),H("Try again?  (y/n)",u(B.x/2,300),60))}}class ec extends Xb{constructor(){super()}o(){super.o()}K(){}F(){H("Your story continues... at a nice farm upstate.",u(B.x/2,200),60)}}
class Rb extends Xb{constructor(){super("intro");this.aa=0}o(){super.o()}K(){this.state.isActive()&&(this.aa+=5,200<this.aa&&this.complete())}J(){super.J();H("Cat-avator... of Doom?",u(B.x/2,70),80);H(`Mock Loading ${Math.round(this.aa)}%`,u(B.x/2,150),80)}F(){}}var cc="KeyY",dc="KeyN";function fc(a){const b=[];a.forEach(d=>{b.push(new gc(d.g,d))});return b}
function hc(){const a=[];a.push(new Z(u(-30,3),u(10,1),new E(1,1,0)));a.push(new Z(u(10,3),u(10,1),new E(1,0,0)));a.push(new Z(u(20,8),u(10,1),new E(0,1,0)));a.push(new Z(u(30,14),u(10,1),new E(0,1,1)));a.push(new Z(u(40,8),u(10,1),new E(1,1,0)));a.push(new Z(u(50,3),u(10,1),new E(1,0,1)));a.push(new Z(u(70,3),u(5,1),new E(0,1,1)));a.push(new Z(u(90,8),u(5,1),new E(1,0,0)));a.push(new Z(u(95,25),u(5,1),new E(0,0,0)));a.push(new Z(u(110,2),u(20,1),new E(0,1,0)));a.push(new Z(u(140,2),u(5,1),new E(1,
.5,.5)));a.push(new Z(u(180,2),u(5,1),new E(0,1,.5)));a.push(new Z(u(240,2),u(5,1),new E(0,1,.5)));a.push(new Z(u(240,-50),u(5,1),new E(0,1,.5)));a.push(new Z(u(-50,32),u(300,1),new E(0,0,0)));return a}
function ic(){const a=[];a.push(new jc(u(-30,5),u(1,1),new E(1,1,0)));a.push(new jc(u(6,5),u(1,1),new E(1,1,0)));a.push(new jc(u(140,5),u(1,1),new E(1,1,0)));a.push(new jc(u(180,7),u(3,3),new E(1,0,1)));a.push(new jc(u(100,30),u(1,1),new E(1,1,0)));a.push(new jc(u(240,4),u(1,1),new E(1,0,0)));a.push(new jc(u(240,-48),u(1,1),new E(1,0,0)));return a}class kc extends Sa{constructor(a,b,d){super(a,b);this.color=d}C(){F(this.g,this.size,this.color)}}
class gc extends kc{constructor(a,b){super(a,u(2,2),new E(1,0,0));this.platform=b;this.speed=u(2/60,0);this.direction=u(1,0);this.g.y=this.platform.g.y+this.platform.size.y/2+this.size.y/2}update(){this.g.x+=this.speed.x*this.direction.x;const a=this.g.x+this.size.x/2,b=this.platform.g.x+this.platform.size.x/2;if(this.g.x-this.size.x/2<this.platform.g.x-this.platform.size.x/2||a>b)this.direction.x*=-1}C(){F(this.g,this.size,this.color)}}class Z extends kc{}
class lc extends kc{constructor(a,b,d,c){super(u(10,4),u(2,3),new E(1,1,1));this.u=a;this.B=b;this.A=c;this.Ta=d;this.h=u(0,0);this.Pa=-.5/60;this.Fa=10/60;this.Ba=.25;this.N=this.Y=0;this.$=this.P=!1}update(){if(!this.P&&!this.$)if(Q("KeyR"))this.$=!0;else if(Q("KeyV"))this.P=!0;else{this.h.x=J("ArrowLeft")?-this.Fa:J("ArrowRight")?this.Fa:0;Q("ArrowUp")&&this.Y<this.N+1&&(this.h.y=this.Ba,this.Y+=1);this.h.y+=this.Pa;this.g=this.g.add(this.h);for(const a of this.u)Ea(this.g,this.size,a.g,a.size)&&
(0>=this.h.y?(this.g.y=a.g.y+a.size.y/2+this.size.y/2,this.Y=this.h.y=0):(this.g.y=a.g.y-a.size.y/2-this.size.y/2,this.h.y*=-1));for(const a of this.A)Ea(this.g,this.size,a.g,a.size)&&(0>this.h.y?(O(a),this.A.splice(this.A.indexOf(a),1),this.h.y=this.Ba):this.P=!0);for(const a of this.B)Ea(this.g,this.size,a.g,a.size)&&(O(a),this.B.splice(this.B.indexOf(a),1),this.N+=1);this.g.y<this.Ta&&6>this.N&&(this.P=!0);7==this.N&&(this.$=!0)}}na(){return this.$}}class jc extends kc{}
function mc(a){O(a.v);a.u.forEach(b=>O(b));a.B.forEach(b=>O(b));a.A.forEach(b=>O(b))}
class nc extends Xb{constructor(){super("platformer");this.u=[];this.B=[];this.A=[];this.v=null}o(){super.o();Oa=u(1920,1080);C=48;this.u=hc();this.B=ic();this.A=fc([this.u[2],this.u[5]]);this.ta=0;this.u.forEach(a=>{a.g.y<this.ta&&(this.ta=a.g.y)});this.v=new lc(this.u,this.B,this.ta,this.A);A=this.v.g.add(u(10,0))}K(){this.state.isActive()&&(this.v.P?(mc(this),this.O()):this.v.na()&&(mc(this),this.complete()))}J(){this.state.isActive()}F(){if(this.state.isActive()){H("The Platformer Stage",u(B.x/
2,100),80);H(`Score: ${this.v.N}`,u(1E3,50),50,new E(1,1,1));var a=this.v.g;H(`Pos: ${Math.round(a.x)}, ${Math.round(a.y)}`,u(1300,50),50,new E(1,1,1));this.u.forEach(b=>b.C());this.B.forEach(b=>b.C());this.A.forEach(b=>b.C());this.v.C();A=this.v.g.add(u(10,0))}}}"use strict";N=!1;const Y=new Vb;
(function(a,b,d,c,f,k=["tiles.png"]){function g(p=0){var r=p-Ib;Ib=p;Jb+=K(.05)*(1E3/(r||1)-Jb);p=J("Equal");const t=J("Minus");r*=p?5:t?.2:1;vb+=r/1E3;X+=r;p||(X=Math.min(X,50));m();r=0;0>X&&-9<X&&(r=X,X=0);for(;0<=X;X-=1E3/60)Fa=Hb++/60,ib||document.hasFocus()||(I=[[]]),G=Za(),hb(),b(),Kb(),Q("Escape")&&(e=!e),e&&(Q("Digit0")&&(aa=!aa),Q("Digit1")&&(h=!h,ca=!1),Q("Digit2")&&(ca=!ca,h=!1),Q("Digit3")&&(fa=!fa),Q("Digit4")&&(n=!n),Q("Digit5")&&(ha=1)),d(),eb();X+=r;B=u(z.width,z.height);w.imageSmoothingEnabled=
!1;N&&Fb();c();D.sort((y,qa)=>y.Ga-qa.Ga);for(var l of D)l.I||l.C();f();ub();ra();N&&sa(w);aa&&(x.textAlign="right",x.textBaseline="top",x.font="1em monospace",x.fillStyle="#000",l="LittleJS v1.9.5 / "+Xa+" / "+D.length+" / "+Jb.toFixed(1)+(N?" GL":" 2D"),x.fillText(l,z.width-3,3),x.fillStyle="#fff",x.fillText(l,z.width-2,2),Xa=0);requestAnimationFrame(g)}function m(){if(Oa.x){z.width=Oa.x;z.height=Oa.y;const p=innerWidth/innerHeight,r=z.width/z.height;(U||z).style.width=z.style.width=v.style.width=
p<r?"100%":"";(U||z).style.height=z.style.height=v.style.height=p<r?"":"100%"}else z.width=Math.min(innerWidth,Na.x),z.height=Math.min(innerHeight,Na.y);v.width=z.width;v.height=z.height;B=u(z.width,z.height)}q(Array.isArray(k),"pass in images as array");document.body.style.cssText="margin:0;overflow:hidden;background:#000;touch-action:none;user-select:none;-webkit-user-select:none;-webkit-touch-callout:none";document.body.appendChild(z=document.createElement("canvas"));w=z.getContext("2d");document.body.appendChild(ia=
document.createElement("a"));ia.style.display="none";N&&Db();document.body.appendChild(v=document.createElement("canvas"));x=v.getContext("2d");(U||z).style.cssText=z.style.cssText=v.style.cssText="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)";m();k=k.map((p,r)=>new Promise(t=>{const l=new Image;l.onerror=l.onload=()=>{Wa[r]=new Ya(l);t()};l.src=p}));Promise.all(k).then(()=>{a();g()})})(function(){Y.oa()},function(){Y.m().K();if(Y.m().getState().ma()&&Y.ua)if(Ub(Y)){Y.ua=!1;var a=
new ec;Mb(a)}else Y.l.pa?(Y.ea(),Y.R()):(Y.l.ia&&(a=new nc,Mb(a)),Y.m().W()?Y.ja():Y.X()?Y.R():Y.m().na()&&(a=Y.l,a.Z.state.complete(),a.H.push(a.Z),a.Z=null,Y.R()))},function(){var a=Y.m();a.Oa&&a.Oa()},function(){var a=Y.m();a.J&&a.J()},function(){var a=Y.m();a.F&&a.F()});
